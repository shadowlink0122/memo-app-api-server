# Memo App API Server

**ğŸ³ DOCKER EXCLUSIVE APPLICATION**

**é‡è¦:** ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Dockerå°‚ç”¨ã§è¨­è¨ˆã•ã‚Œã¦ãŠã‚Šã€ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®Goã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®æ“ä½œã¯Docker Composeã‚’é€šã˜ã¦è¡Œã£ã¦ãã ã•ã„ã€‚

Go + Ginã‚’ä½¿ç”¨ã—ãŸREST APIã‚µãƒ¼ãƒãƒ¼ã§ã™ã€‚

è‡ªå·±ç®¡ç†ã‚’ã—ã‚„ã™ãã™ã‚‹ãŸã‚ã®ãƒ¡ãƒ¢ã‚¢ãƒ—ãƒªã‚’æƒ³å®šã—ã¦ã„ã¾ã™ã€‚

ãƒã‚¤ã‚¯ãƒ­ã‚µãƒ¼ãƒ“ã‚¹åŒ–ã—ãŸã„ & é™çš„å‹ä»˜ã‘è¨€èªãŒå¥½ãã€ã¨ã„ã†ç†ç”±ã‹ã‚‰Goã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

### å®Ÿç¾ã—ãŸã„ã“ã¨

- githubã‚¢ã‚«ã‚¦ãƒ³ãƒˆã§ç™»éŒ²å¯èƒ½
- privateæ©Ÿèƒ½(ãƒ¡ã‚¤ãƒ³)
    - ã‚ã‹ã‚‰ãªã„ã‚‚ã®ã€å›°ã£ãŸã“ã¨ã‚’ç°¡å˜ã«ãƒ¡ãƒ¢ã§ãã‚‹
        - å¾Œã‹ã‚‰è¿½åŠ ã‚³ãƒ¡ãƒ³ãƒˆã€è§£æ±ºã§ããŸã‹ã‚ã‹ã‚‹ã‚ˆã†ã«ã™ã‚‹
        - ç²’åº¦ã¯ ä¸€è¨€ä»¥ä¸Šã€issue æœªæº€
- publicæ©Ÿèƒ½
    - æŠ€è¡“ãƒ–ãƒ­ã‚°
        - ã‚³ãƒ¼ãƒ‰ã‚„å·®åˆ†ãŒã‚ã‹ã‚Šã‚„ã™ã„

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 

```
memo-app-api-server/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.go                    # ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â””â”€â”€ config.go             # è¨­å®šç®¡ç†ï¼ˆDBã€S3ã€ãƒ­ã‚°ç­‰ï¼‰
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ memo.go               # ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«å®šç¾©
â”‚   â”œâ”€â”€ database/
â”‚   â”‚   â””â”€â”€ database.go           # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šç®¡ç†
â”‚   â”œâ”€â”€ repository/
â”‚   â”‚   â”œâ”€â”€ interface.go          # ãƒªãƒã‚¸ãƒˆãƒªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â””â”€â”€ memo_repository.go    # ãƒ¡ãƒ¢ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤
â”‚   â”œâ”€â”€ service/
â”‚   â”‚   â”œâ”€â”€ interface.go          # ã‚µãƒ¼ãƒ“ã‚¹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
â”‚   â”‚   â””â”€â”€ memo_service.go       # ãƒ¡ãƒ¢ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â”œâ”€â”€ handlers/
â”‚   â”‚   â””â”€â”€ memo_handler.go       # ãƒ¡ãƒ¢APIãƒãƒ³ãƒ‰ãƒ©ãƒ¼
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â””â”€â”€ routes.go             # ãƒ«ãƒ¼ãƒˆè¨­å®š
â”‚   â”œâ”€â”€ logger/
â”‚   â”‚   â””â”€â”€ logger.go             # æ§‹é€ åŒ–ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.go               # èªè¨¼ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â”œâ”€â”€ cors.go               # CORSè¨­å®š
â”‚   â”‚   â”œâ”€â”€ logger.go             # ãƒ­ã‚°ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢
â”‚   â”‚   â””â”€â”€ rate_limit.go         # ãƒ¬ãƒ¼ãƒˆåˆ¶é™
â”‚   â””â”€â”€ storage/
â”‚       â””â”€â”€ s3_uploader.go        # S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ api_test.go               # APIãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
â”‚   â”œâ”€â”€ models/                   # ãƒ¢ãƒ‡ãƒ«ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ service/                  # ã‚µãƒ¼ãƒ“ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ handlers/                 # ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ middleware/               # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ logger/                   # ãƒ­ã‚°ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ storage/                  # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ database/                 # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
â”‚   â”œâ”€â”€ integration/              # çµ±åˆãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ e2e/                      # E2Eãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ logs/                         # ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›å…ˆ
â”œâ”€â”€ scripts/
â”‚   â””â”€â”€ init-minio.sh            # MinIOåˆæœŸåŒ–ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ migrations/                  # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
â”‚   â”œâ”€â”€ 000_create_test_db.sql      # ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ä½œæˆ
â”‚   â”œâ”€â”€ 001_initial_schema.up.sql   # åˆæœŸã‚¹ã‚­ãƒ¼ãƒä½œæˆ
â”‚   â”œâ”€â”€ 001_initial_schema.down.sql # åˆæœŸã‚¹ã‚­ãƒ¼ãƒå‰Šé™¤
â”‚   â”œâ”€â”€ 002_sample_data.up.sql      # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŒ¿å…¥
â”‚   â””â”€â”€ 002_sample_data.down.sql    # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å‰Šé™¤
â”œâ”€â”€ go.mod                       # Go ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«å®šç¾©
â”œâ”€â”€ go.sum                       # ä¾å­˜é–¢ä¿‚ã®ãƒãƒƒã‚·ãƒ¥
â”œâ”€â”€ Makefile                     # ãƒ“ãƒ«ãƒ‰ãƒ»ãƒ†ã‚¹ãƒˆç”¨ã‚³ãƒãƒ³ãƒ‰
â”œâ”€â”€ docker-compose.yml           # Dockeræ§‹æˆï¼ˆDB + MinIOï¼‰
â””â”€â”€ README.md                    # ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«
```

## ä¸»ãªæ©Ÿèƒ½

### ãƒ¡ãƒ¢API

#### ãƒ¡ãƒ¢ç®¡ç†æ©Ÿèƒ½
- **CRUDæ“ä½œ**: ãƒ¡ãƒ¢ã®ä½œæˆã€èª­ã¿å–ã‚Šã€æ›´æ–°ã€å‰Šé™¤
- **ã‚«ãƒ†ã‚´ãƒªæ©Ÿèƒ½**: ãƒ¡ãƒ¢ã‚’ã‚«ãƒ†ã‚´ãƒªåˆ¥ã«åˆ†é¡
- **ã‚¿ã‚°æ©Ÿèƒ½**: è¤‡æ•°ã®ã‚¿ã‚°ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ã®åˆ†é¡
- **å„ªå…ˆåº¦è¨­å®š**: low/medium/high ã®å„ªå…ˆåº¦è¨­å®š
- **ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç®¡ç†**: active/archived ã«ã‚ˆã‚‹ãƒ¡ãƒ¢ã®çŠ¶æ…‹ç®¡ç†
- **æ¤œç´¢æ©Ÿèƒ½**: ã‚¿ã‚¤ãƒˆãƒ«ã¨ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®å…¨æ–‡æ¤œç´¢
- **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°**: ã‚«ãƒ†ã‚´ãƒªã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã€å„ªå…ˆåº¦ã«ã‚ˆã‚‹çµã‚Šè¾¼ã¿
- **ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: å¤§é‡ã®ãƒ¡ãƒ¢ã®åŠ¹ç‡çš„ãªå–å¾—

#### APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ

##### ãƒ‘ãƒ–ãƒªãƒƒã‚¯ï¼ˆèªè¨¼ä¸è¦ï¼‰
- `GET /` - Hello Worldï¼ˆJSONå½¢å¼ï¼‰
- `GET /health` - ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
- `GET /hello` - Hello Worldï¼ˆãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ï¼‰

##### ãƒ¡ãƒ¢APIï¼ˆèªè¨¼å¿…è¦ï¼‰
- `POST /api/memos` - ãƒ¡ãƒ¢ã®ä½œæˆ
- `GET /api/memos` - ãƒ¡ãƒ¢ä¸€è¦§å–å¾—ï¼ˆãƒ•ã‚£ãƒ«ã‚¿ãƒ»ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³å¯¾å¿œï¼‰
- `GET /api/memos/:id` - ç‰¹å®šã®ãƒ¡ãƒ¢å–å¾—
- `PUT /api/memos/:id` - ãƒ¡ãƒ¢ã®æ›´æ–°
- `DELETE /api/memos/:id` - ãƒ¡ãƒ¢ã®å‰Šé™¤
- `PATCH /api/memos/:id/archive` - ãƒ¡ãƒ¢ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–
- `PATCH /api/memos/:id/restore` - ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–ãƒ¡ãƒ¢ã®å¾©å…ƒ
- `GET /api/memos/search?q=æ¤œç´¢èª` - ãƒ¡ãƒ¢ã®æ¤œç´¢

##### ãã®ä»–ãƒ—ãƒ©ã‚¤ãƒ™ãƒ¼ãƒˆ
- `GET /api/protected` - èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆï¼ˆãƒ‡ãƒ¢ç”¨ï¼‰

### ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢

- **LoggerMiddleware** - æ§‹é€ åŒ–ãƒ­ã‚°ã«ã‚ˆã‚‹ãƒªã‚¯ã‚¨ã‚¹ãƒˆãƒ­ã‚°
- **CORSMiddleware** - CORSè¨­å®š
- **AuthMiddleware** - ãƒ¦ãƒ¼ã‚¶ãƒ¼èªè¨¼ï¼ˆç¾åœ¨ã¯ç©ºå®Ÿè£…ï¼‰
- **RateLimitMiddleware** - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ï¼ˆç¾åœ¨ã¯ç©ºå®Ÿè£…ï¼‰

### ãƒ­ã‚°æ©Ÿèƒ½

- **æ§‹é€ åŒ–ãƒ­ã‚°**: JSONå½¢å¼ã§ã®ãƒ­ã‚°å‡ºåŠ›
- **ãƒ•ã‚¡ã‚¤ãƒ«å‡ºåŠ›**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ‡ã‚£ã‚¹ã‚¯ã¸ã®ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ä¿å­˜
- **è‡ªå‹•ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ä»˜ããƒ•ã‚¡ã‚¤ãƒ«å
- **S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: ä¸€å®šæœŸé–“å¾Œã«å¤ã„ãƒ­ã‚°ã‚’S3äº’æ›ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã«è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **MinIOçµ±åˆ**: é–‹ç™ºç’°å¢ƒç”¨S3äº’æ›ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

## ãƒ­ã‚°æ©Ÿèƒ½ã®è©³ç´°

### ãƒ­ã‚°å‡ºåŠ›å½¢å¼

æ§‹é€ åŒ–ãƒ­ã‚°ï¼ˆJSONå½¢å¼ï¼‰ã§ä»¥ä¸‹ã®æƒ…å ±ã‚’è¨˜éŒ²ï¼š

```json
{
  "level": "info",
  "msg": "ãƒªã‚¯ã‚¨ã‚¹ãƒˆå®Œäº† - æˆåŠŸ",
  "method": "GET",
  "uri": "/",
  "client_ip": "127.0.0.1",
  "status_code": 200,
  "latency_ms": 0,
  "time": "2024-07-21T10:30:00+09:00"
}
```

### ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†

- **å‡ºåŠ›å…ˆ**: `logs/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª
- **ãƒ•ã‚¡ã‚¤ãƒ«å**: `app_YYYY-MM-DD_HH-mm-ss.log`
- **è‡ªå‹•ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰**: è¨­å®šå¯èƒ½ãªé–“éš”ã§S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
- **ãƒ­ãƒ¼ã‚«ãƒ«å‰Šé™¤**: ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å¾Œã«å¤ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è‡ªå‹•å‰Šé™¤

### S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰è¨­å®š

ç’°å¢ƒå¤‰æ•°ã§åˆ¶å¾¡ï¼š

```bash
LOG_UPLOAD_ENABLED=true      # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰æ©Ÿèƒ½ã®æœ‰åŠ¹/ç„¡åŠ¹
LOG_UPLOAD_MAX_AGE=24h       # ã“ã®æœŸé–“ã‚’éããŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
LOG_UPLOAD_INTERVAL=1h       # ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯ã®é–“éš”
```

## æœ¬ç•ªç’°å¢ƒã§ã®ä½¿ç”¨

### AWS S3ä½¿ç”¨æ™‚ã®è¨­å®šä¾‹

```bash
# .env ã¾ãŸã¯ç’°å¢ƒå¤‰æ•°ã§è¨­å®š
S3_ENDPOINT=                    # ç©ºã«ã™ã‚‹ã¨AWS S3ã‚’ä½¿ç”¨
S3_ACCESS_KEY_ID=your-access-key
S3_SECRET_ACCESS_KEY=your-secret-key
S3_REGION=ap-northeast-1
S3_BUCKET=your-production-logs-bucket
S3_USE_SSL=true
```

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è€ƒæ…®äº‹é …

1. **èªè¨¼æƒ…å ±**: AWSèªè¨¼æƒ…å ±ã¯ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†
2. **CORSè¨­å®š**: æœ¬ç•ªç’°å¢ƒã§ã¯é©åˆ‡ãªã‚ªãƒªã‚¸ãƒ³ã‚’è¨­å®š
3. **ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«**: æœ¬ç•ªç’°å¢ƒã§ã¯ `warn` ã¾ãŸã¯ `error` ãƒ¬ãƒ™ãƒ«ã‚’æ¨å¥¨
4. **ãƒã‚±ãƒƒãƒˆãƒãƒªã‚·ãƒ¼**: S3ãƒã‚±ãƒƒãƒˆã¯é©åˆ‡ãªã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡ã‚’è¨­å®š

## ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

### å‰ææ¡ä»¶

**é‡è¦:** ã“ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¯Dockerå°‚ç”¨ã§è¨­è¨ˆã•ã‚Œã¦ã„ã¾ã™ã€‚ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã§ã®Goã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚

- Docker 20.xä»¥ä¸Š
- Docker Compose 2.xä»¥ä¸Š

### ç’°å¢ƒå¤‰æ•°è¨­å®š

ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒ”ãƒ¼ã—ã¦è¨­å®šï¼š

```bash
cp .env.example .env
```

ä¸»è¦ãªè¨­å®šé …ç›®ï¼š

```bash
# ã‚µãƒ¼ãƒãƒ¼è¨­å®š
SERVER_PORT=8080

# ãƒ­ã‚°è¨­å®š
LOG_LEVEL=info
LOG_DIRECTORY=logs
LOG_UPLOAD_ENABLED=true
LOG_UPLOAD_MAX_AGE=24h
LOG_UPLOAD_INTERVAL=1h

# S3/MinIOè¨­å®š
S3_ENDPOINT=http://localhost:9000
S3_ACCESS_KEY_ID=minioadmin
S3_SECRET_ACCESS_KEY=minioadmin
S3_BUCKET=memo-app-logs
```

### Dockerç’°å¢ƒã§ã®èµ·å‹•

#### 1. å…¨ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•

```bash
# å…¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’èµ·å‹•ï¼ˆPostgreSQL + MinIO + ã‚¢ãƒ—ãƒªï¼‰
docker compose up -d

# MinIOãƒã‚±ãƒƒãƒˆã‚’åˆæœŸåŒ–
./scripts/init-minio.sh

# ãƒ­ã‚°ã‚’ç¢ºèª
docker compose logs -f app
```

#### 2. å€‹åˆ¥ã‚µãƒ¼ãƒ“ã‚¹ã®èµ·å‹•

```bash
# ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã¨MinIOã®ã¿èµ·å‹•
docker compose up -d db minio

# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚‚å«ã‚ã¦èµ·å‹•
docker compose up -d
```

ã‚µãƒ¼ãƒãƒ¼ã¯ `http://localhost:8080` ã§èµ·å‹•ã—ã¾ã™ã€‚

#### 3. ã‚µãƒ¼ãƒ“ã‚¹ç®¡ç†

```bash
# ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
docker compose down

# ãƒœãƒªãƒ¥ãƒ¼ãƒ ã‚‚å«ã‚ã¦å®Œå…¨å‰Šé™¤
docker compose down -v

# ãƒ­ã‚°ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º
docker compose logs -f

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®ãƒ­ã‚°
docker compose logs -f app
```

### æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•

æœ¬ç•ªç’°å¢ƒã§ã¯å¤–éƒ¨ã®ãƒãƒãƒ¼ã‚¸ãƒ‰ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆAWS RDSã€S3ç­‰ï¼‰ã‚’ä½¿ç”¨ã—ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒ†ãƒŠã®ã¿ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

#### 1. æœ¬ç•ªç’°å¢ƒç”¨è¨­å®š

```bash
# æœ¬ç•ªç’°å¢ƒç”¨ã®ç’°å¢ƒå¤‰æ•°ã‚’ã‚³ãƒ”ãƒ¼
cp .env.production .env

# å¿…è¦ãªå€¤ã‚’è¨­å®šï¼ˆç‰¹ã«ä»¥ä¸‹ã¯å¿…é ˆï¼‰
# DB_HOST=your-rds-endpoint.region.rds.amazonaws.com
# DB_PASSWORD=your-secure-password
# S3_ACCESS_KEY_ID=your-aws-access-key
# S3_SECRET_ACCESS_KEY=your-aws-secret-key
```

#### 2. æœ¬ç•ªç’°å¢ƒã§ã®èµ·å‹•

```bash
# æœ¬ç•ªç’°å¢ƒç”¨Docker Composeã§èµ·å‹•
make docker-prod-up

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
docker compose -f docker-compose.prod.yml up -d

# ãƒ­ã‚°ã‚’ç¢ºèª
docker compose -f docker-compose.prod.yml logs -f app

# ç›£è¦–ã‚µãƒ¼ãƒ“ã‚¹ã‚‚èµ·å‹•ã™ã‚‹å ´åˆ
docker compose -f docker-compose.prod.yml --profile monitoring up -d
```

#### 3. æœ¬ç•ªç’°å¢ƒã§ã®åœæ­¢

```bash
# æœ¬ç•ªç’°å¢ƒç”¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢
make docker-prod-down

# ã¾ãŸã¯ç›´æ¥å®Ÿè¡Œ
docker compose -f docker-compose.prod.yml down
```

#### 4. å‰ææ¡ä»¶ï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

- **AWS RDS**: PostgreSQL 15ä»¥ä¸Šã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹
- **AWS S3**: ãƒ­ã‚°ä¿å­˜ç”¨ã®ãƒã‚±ãƒƒãƒˆ
- **ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚°ãƒ«ãƒ¼ãƒ—**: é©åˆ‡ãªãƒãƒ¼ãƒˆï¼ˆ80, 443ï¼‰ã®é–‹æ”¾
- **SSLè¨¼æ˜æ›¸**: HTTPSé€šä¿¡ç”¨ã®è¨¼æ˜æ›¸è¨­å®š

### ç®¡ç†ç”»é¢ã‚¢ã‚¯ã‚»ã‚¹

- **MinIOç®¡ç†ç”»é¢**: http://localhost:9001ï¼ˆé–‹ç™ºç’°å¢ƒã®ã¿ï¼‰
  - ãƒ¦ãƒ¼ã‚¶ãƒ¼å: `minioadmin`
  - ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰: `minioadmin`
- **API ã‚µãƒ¼ãƒãƒ¼**: http://localhost:8080ï¼ˆé–‹ç™ºç’°å¢ƒï¼‰/ http://your-domain.comï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

## ãƒ†ã‚¹ãƒˆ

### Dockerç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

**é‡è¦:** ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã¯Dockerç’°å¢ƒã§ã®ã¿å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ãƒ­ãƒ¼ã‚«ãƒ«Goã‚³ãƒãƒ³ãƒ‰ã§ã®ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚

```bash
# Dockerç’°å¢ƒã§ãƒ†ã‚¹ãƒˆã‚³ãƒ³ãƒ†ãƒŠã‚’å®Ÿè¡Œ
docker compose -f docker-compose.test.yml up --build --abort-on-container-exit

# ã¾ãŸã¯å€‹åˆ¥ã«ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
docker compose exec app make test

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆç¨®åˆ¥ã‚’å®Ÿè¡Œ
docker compose exec app make test-unit          # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
docker compose exec app make test-integration   # çµ±åˆãƒ†ã‚¹ãƒˆ
docker compose exec app make test-database      # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
docker compose exec app make test-e2e          # E2Eãƒ†ã‚¹ãƒˆ

# ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ä»˜ãã§å®Ÿè¡Œ
docker compose exec app make test-coverage
```

### ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
test/
â”œâ”€â”€ api_test.go                   # åŸºæœ¬APIãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ middleware/
â”‚   â””â”€â”€ middleware_test.go        # ãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ config/
â”‚   â””â”€â”€ config_test.go           # è¨­å®šãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ logger/
â”‚   â””â”€â”€ logger_test.go           # ãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ storage/
â”‚   â””â”€â”€ storage_test.go          # S3ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ database/
â”‚   â””â”€â”€ database_test.go         # ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ integration/
â”‚   â””â”€â”€ integration_test.go      # çµ±åˆãƒ†ã‚¹ãƒˆ
â””â”€â”€ e2e/
    â””â”€â”€ e2e_test.go             # E2Eãƒ†ã‚¹ãƒˆ
```

### ãƒ†ã‚¹ãƒˆç’°å¢ƒã®å‰ææ¡ä»¶

- **ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆ**: Docker ComposeãŒèµ·å‹•ã—ã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™
- **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ**: PostgreSQLã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ï¼ˆ`docker compose up -d db`ï¼‰
- **E2Eãƒ†ã‚¹ãƒˆ**: å…¨ã‚µãƒ¼ãƒ“ã‚¹ãŒå¿…è¦ï¼ˆ`docker compose up -d`ï¼‰

## é–‹ç™ºã¨ãƒ“ãƒ«ãƒ‰

### Dockerç’°å¢ƒã§ã®é–‹ç™º

**é‡è¦:** ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®Goã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œã¯ã‚µãƒãƒ¼ãƒˆã—ã¦ã„ã¾ã›ã‚“ã€‚ã™ã¹ã¦ã®é–‹ç™ºä½œæ¥­ã¯Dockerç’°å¢ƒã§è¡Œã£ã¦ãã ã•ã„ã€‚

```bash
# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’Dockerç’°å¢ƒã§ãƒ“ãƒ«ãƒ‰
docker compose exec app make build

# Dockerã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã‚·ã‚§ãƒ«ã‚’é–‹ãï¼ˆé–‹ç™ºä½œæ¥­ç”¨ï¼‰
docker compose exec app /bin/sh

# ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã®ç›£è¦–ï¼ˆHot Reloadï¼‰
# docker-compose.ymlã§volumesãŒãƒã‚¦ãƒ³ãƒˆã•ã‚Œã¦ã„ã‚‹ãŸã‚
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã™ã‚‹ã¨è‡ªå‹•çš„ã«ã‚³ãƒ³ãƒ†ãƒŠã«åæ˜ ã•ã‚Œã¾ã™
```

### åˆ©ç”¨å¯èƒ½ãªDockerã‚³ãƒãƒ³ãƒ‰

```bash
# Dockerç’°å¢ƒã®ç®¡ç†
docker compose up -d          # å…¨ã‚µãƒ¼ãƒ“ã‚¹èµ·å‹•
docker compose down           # å…¨ã‚µãƒ¼ãƒ“ã‚¹åœæ­¢
docker compose logs -f app    # ã‚¢ãƒ—ãƒªãƒ­ã‚°ã®ç›£è¦–
docker compose restart app   # ã‚¢ãƒ—ãƒªã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•

# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§ã®ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œ
docker compose exec app make test              # ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
docker compose exec app make test-coverage     # ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’ç”Ÿæˆ
docker compose exec app make build             # ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒ“ãƒ«ãƒ‰
```

## ä½¿ç”¨æŠ€è¡“

- **Go** 1.24.5
- **Gin** - HTTPã‚¦ã‚§ãƒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯  
- **Testify** - ãƒ†ã‚¹ãƒˆãƒ©ã‚¤ãƒ–ãƒ©ãƒª
- **Docker** - ã‚³ãƒ³ãƒ†ãƒŠåŒ–ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
- **Docker Compose** - ãƒãƒ«ãƒã‚³ãƒ³ãƒ†ãƒŠç®¡ç†
- **PostgreSQL** - ãƒªãƒ¬ãƒ¼ã‚·ãƒ§ãƒŠãƒ«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
- **MinIO** - S3äº’æ›ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸

## ä»Šå¾Œã®æ‹¡å¼µäºˆå®š

- JWTèªè¨¼ã®å®Ÿè£…
- API ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã®å®Ÿè£…
- ãƒ­ã‚°è¨­å®šã®æ”¹å–„
- CI/CD ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³

## APIä½¿ç”¨ä¾‹

### 1. ãƒ¡ãƒ¢ã®ä½œæˆ

```bash
curl -X POST http://localhost:8080/api/memos \
  -H "Content-Type: application/json" \
  -d '{
    "title": "é‡è¦ãªã‚¿ã‚¹ã‚¯",
    "content": "æ˜æ—¥ã¾ã§ã«ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã‚’ä½œæˆã™ã‚‹",
    "category": "ä»•äº‹",
    "tags": ["ãƒ—ãƒ¬ã‚¼ãƒ³", "é‡è¦"],
    "priority": "high"
  }'
```

### 2. ãƒ¡ãƒ¢ä¸€è¦§ã®å–å¾—

```bash
# å…¨ãƒ¡ãƒ¢å–å¾—
curl http://localhost:8080/api/memos

# ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ä»˜ãå–å¾—
curl "http://localhost:8080/api/memos?category=ä»•äº‹&status=active&page=1&limit=10"
```

### 3. ç‰¹å®šã®ãƒ¡ãƒ¢å–å¾—

```bash
curl http://localhost:8080/api/memos/1
```

### 4. ãƒ¡ãƒ¢ã®æ›´æ–°

```bash
curl -X PUT http://localhost:8080/api/memos/1 \
  -H "Content-Type: application/json" \
  -d '{
    "title": "æ›´æ–°ã•ã‚ŒãŸã‚¿ã‚¹ã‚¯",
    "priority": "medium"
  }'
```

### 5. ãƒ¡ãƒ¢ã®æ¤œç´¢

```bash
curl "http://localhost:8080/api/memos/search?q=ãƒ—ãƒ¬ã‚¼ãƒ³&page=1&limit=5"
```

### 6. ãƒ¡ãƒ¢ã®ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–

```bash
curl -X PATCH http://localhost:8080/api/memos/1/archive
```

### 7. ãƒ¡ãƒ¢ã®å‰Šé™¤

```bash
curl -X DELETE http://localhost:8080/api/memos/1
```

### ãƒ¬ã‚¹ãƒãƒ³ã‚¹ä¾‹

#### ãƒ¡ãƒ¢ä½œæˆæˆåŠŸæ™‚

```json
{
  "id": 1,
  "title": "é‡è¦ãªã‚¿ã‚¹ã‚¯",
  "content": "æ˜æ—¥ã¾ã§ã«ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã‚’ä½œæˆã™ã‚‹",
  "category": "ä»•äº‹",
  "tags": "[\"ãƒ—ãƒ¬ã‚¼ãƒ³\", \"é‡è¦\"]",
  "priority": "high",
  "status": "active",
  "created_at": "2025-07-21T10:00:00+09:00",
  "updated_at": "2025-07-21T10:00:00+09:00",
  "completed_at": null
}
```

#### ãƒ¡ãƒ¢ä¸€è¦§å–å¾—æ™‚

```json
{
  "memos": [
    {
      "id": 1,
      "title": "é‡è¦ãªã‚¿ã‚¹ã‚¯",
      "content": "æ˜æ—¥ã¾ã§ã«ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ã‚’ä½œæˆã™ã‚‹",
      "category": "ä»•äº‹",
      "tags": "[\"ãƒ—ãƒ¬ã‚¼ãƒ³\", \"é‡è¦\"]",
      "priority": "high",
      "status": "active",
      "created_at": "2025-07-21T10:00:00+09:00",
      "updated_at": "2025-07-21T10:00:00+09:00"
    }
  ],
  "total": 1,
  "page": 1,
  "limit": 10,
  "total_pages": 1
}
```

```bash
# Hello World
curl http://localhost:8080/

# ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯
curl http://localhost:8080/health

# èªè¨¼ãŒå¿…è¦ãªã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
curl http://localhost:8080/api/protected
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€`migrations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½¿ç”¨ã—ãŸãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³æ§‹æˆ

```
migrations/
â”œâ”€â”€ 000_create_test_db.sql       # ãƒ†ã‚¹ãƒˆç”¨DBä½œæˆ
â”œâ”€â”€ 001_initial_schema.up.sql    # åˆæœŸã‚¹ã‚­ãƒ¼ãƒä½œæˆï¼ˆUpï¼‰
â”œâ”€â”€ 001_initial_schema.down.sql  # åˆæœŸã‚¹ã‚­ãƒ¼ãƒå‰Šé™¤ï¼ˆDownï¼‰
â”œâ”€â”€ 002_sample_data.up.sql       # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿æŠ•å…¥ï¼ˆUpï¼‰
â”œâ”€â”€ 002_sample_data.down.sql     # ã‚µãƒ³ãƒ—ãƒ«ãƒ‡ãƒ¼ã‚¿å‰Šé™¤ï¼ˆDownï¼‰
â””â”€â”€ ...                          # ä»Šå¾Œã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
```

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å®Ÿè¡Œ

å°‚ç”¨ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ`scripts/migrate-database.sh`ï¼‰ã‚’ä½¿ç”¨ã—ã¦ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

##### åŸºæœ¬çš„ãªä½¿ç”¨æ–¹æ³•

```bash
# ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
make migrate

# ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
make migrate-test

# ä¸¡æ–¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
make migrate-all

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã®ç¢ºèªï¼ˆå®Ÿè¡Œãªã—ï¼‰
make migrate-dry-run
```

##### Dockerç’°å¢ƒã§ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# Dockerç’°å¢ƒã®ãƒ¡ã‚¤ãƒ³ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
make docker-migrate

# Dockerç’°å¢ƒã®ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
make docker-migrate-test

# Dockerç’°å¢ƒã®ä¸¡æ–¹ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
make docker-migrate-all
```

##### æ‰‹å‹•å®Ÿè¡Œ

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥ä½¿ç”¨ã™ã‚‹ã“ã¨ã‚‚å¯èƒ½ã§ã™ï¼š

```bash
# åŸºæœ¬çš„ãªå®Ÿè¡Œ
./scripts/migrate-database.sh --both --verbose

# ã‚«ã‚¹ã‚¿ãƒ æ¥ç¶šè¨­å®š
./scripts/migrate-database.sh \
  --host localhost \
  --port 5432 \
  --username memo_user \
  --database memo_db \
  --both \
  --verbose

# DATABASE_URL ã‚’ä½¿ç”¨
DATABASE_URL="postgres://user:pass@host:5432/dbname" \
./scripts/migrate-database.sh --both

# ãƒ‰ãƒ©ã‚¤ãƒ©ãƒ³ï¼ˆå®Ÿè¡Œãªã—ï¼‰
./scripts/migrate-database.sh --dry-run --verbose
```

#### æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã®è¿½åŠ 

æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹å ´åˆï¼š

1. **å‘½åè¦å‰‡**: `003_description.up.sql` ã¨ `003_description.down.sql`
2. **Upãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã®é©ç”¨
3. **Downãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚¹ã‚­ãƒ¼ãƒå¤‰æ›´ã®å–ã‚Šæ¶ˆã—

ä¾‹ï¼š

```bash
# æ–°ã—ã„ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ
migrations/003_add_user_profile.up.sql    # å¤‰æ›´é©ç”¨
migrations/003_add_user_profile.down.sql  # å¤‰æ›´å–ã‚Šæ¶ˆã—
```

ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯è‡ªå‹•çš„ã« `migrations/` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå†…ã® `*.sql` ãƒ•ã‚¡ã‚¤ãƒ«ã‚’åå‰é †ã«å®Ÿè¡Œã—ã¾ã™ã€‚

#### ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **Down ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³**: å¿…ãšä½œæˆã—ã¦ã€å¤‰æ›´ã‚’å¯é€†ã«ã™ã‚‹
2. **ãƒ†ã‚¹ãƒˆ**: æœ¬ç•ªé©ç”¨å‰ã«é–‹ç™ºãƒ»ãƒ†ã‚¹ãƒˆç’°å¢ƒã§æ¤œè¨¼
3. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—**: é‡è¦ãªãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å‰ã¯ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
4. **åŸå­æ€§**: 1ã¤ã®ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã§é–¢é€£ã™ã‚‹å¤‰æ›´ã‚’ã¾ã¨ã‚ã‚‹

#### CI/CDã§ã®ã‚³ãƒ¼ãƒ‰å“è³ªç®¡ç†

CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã§ã¯ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã—ã¾ã™ï¼š

##### ãƒªãƒ³ãƒˆå‡¦ç†
- **Dockerç’°å¢ƒ**: ã‚³ãƒ³ãƒ†ãƒŠå†…ã§`make lint-ci`ã‚’å®Ÿè¡Œ
- **ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯**: Dockerå¤±æ•—æ™‚ã¯ãƒ›ã‚¹ãƒˆç’°å¢ƒã§æ¨™æº–Goãƒ„ãƒ¼ãƒ«ã‚’ä½¿ç”¨
- **ãƒã‚§ãƒƒã‚¯å†…å®¹**:
  - `go fmt`: ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ç¢ºèª
  - `go vet`: é™çš„è§£æï¼ˆæ½œåœ¨çš„ãƒã‚°ã®æ¤œå‡ºï¼‰
  - `go mod tidy`: ä¾å­˜é–¢ä¿‚ã®æ•´åˆæ€§ç¢ºèª

##### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®ãƒªãƒ³ãƒˆå®Ÿè¡Œ

```bash
# è»½é‡ãªCIç”¨ãƒªãƒ³ãƒˆï¼ˆæ¨å¥¨ï¼‰
make lint-ci

# golangci-lintä½¿ç”¨ï¼ˆã‚ˆã‚Šè©³ç´°ã€è¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼‰
make lint

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã®ã¿å®Ÿè¡Œ
make fmt

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯ã®ã¿
make fmt-check
```

golangci-lintãŒã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã•ã‚Œã¦ã„ãªã„å ´åˆã€`make lint`ã¯è‡ªå‹•çš„ã«`go vet`ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ã—ã¾ã™ã€‚

#### PRç®¡ç†ã¨ãƒãƒ¼ã‚¸ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«ã¯åŒ…æ‹¬çš„ãªCI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ãŒå®Ÿè£…ã•ã‚Œã¦ãŠã‚Šã€ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãŒè‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ã€‚GitHubã®branch protection rulesã‚’è¨­å®šã™ã‚‹ã“ã¨ã§ã€ã“ã‚Œã‚‰ã®ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã®ã¿PRã®ãƒãƒ¼ã‚¸ãŒå¯èƒ½ã«ãªã‚Šã¾ã™ã€‚

##### PRã®ä½œæˆã¨ç®¡ç†

```bash
# é–‹ç™ºç’°å¢ƒã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆåˆå›ã®ã¿ï¼‰
make init

# PRä½œæˆï¼ˆDraftã¨ã—ã¦ä½œæˆï¼‰
make pr-create

# Ready for reviewã«ã™ã‚‹
make pr-ready

# PRã®çŠ¶æ…‹ç¢ºèª
make pr-check

# PRã®è©³ç´°æƒ…å ±ç¢ºèª
make pr-info
```

##### ãƒãƒ¼ã‚¸ã®å®Ÿè¡Œ

CIãƒã‚§ãƒƒã‚¯ãŒå…¨ã¦æˆåŠŸã—ãŸå ´åˆã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒãƒ¼ã‚¸ã§ãã¾ã™ï¼š

```bash
# Squash mergeï¼ˆæ¨å¥¨ï¼‰
make pr-merge

# Merge commit
make pr-merge-commit

# ãƒãƒ¼ã‚¸å‰ã®æœ€çµ‚ç¢ºèª
make pr-status
```

##### CI/CDãƒã‚§ãƒƒã‚¯é …ç›®

ä»¥ä¸‹ã®ãƒã‚§ãƒƒã‚¯ãŒPRã”ã¨ã«è‡ªå‹•å®Ÿè¡Œã•ã‚Œã¾ã™ï¼š

- âœ… **Build**: ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ãƒ“ãƒ«ãƒ‰ç¢ºèª
- âœ… **Tests**: å˜ä½“ãƒ»çµ±åˆãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
- âœ… **Lint**: ã‚³ãƒ¼ãƒ‰å“è³ªã¨ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒã‚§ãƒƒã‚¯
- âœ… **Security Scan**: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ã®ã‚¹ã‚­ãƒ£ãƒ³
- âœ… **E2E Tests**: ã‚¨ãƒ³ãƒ‰ãƒ„ãƒ¼ã‚¨ãƒ³ãƒ‰ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ

**æ³¨æ„**: ã“ã‚Œã‚‰ã®ãƒã‚§ãƒƒã‚¯ã‚’å¿…é ˆã«ã™ã‚‹ã«ã¯ã€GitHubãƒªãƒã‚¸ãƒˆãƒªã§branch protection rulesã®è¨­å®šãŒå¿…è¦ã§ã™ã€‚è¨­å®šã™ã‚‹ã¨ã€å…¨ã¦ã®ãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã—ãŸå ´åˆã®ã¿ãƒãƒ¼ã‚¸ãƒœã‚¿ãƒ³ãŒæœ‰åŠ¹ã«ãªã‚Šã¾ã™ã€‚

##### Branch Protection Rulesã®è¨­å®š

ãƒªãƒã‚¸ãƒˆãƒªç®¡ç†è€…ãŒGitHubã§ä»¥ä¸‹ã®è¨­å®šã‚’è¡Œã†ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ï¼š

1. ãƒªãƒã‚¸ãƒˆãƒªã® `Settings` > `Branches` > `Add rule` ã‚’é¸æŠ
2. Branch name pattern: `main` (ã¾ãŸã¯ `master`)
3. ä»¥ä¸‹ã®ã‚ªãƒ—ã‚·ãƒ§ãƒ³ã‚’æœ‰åŠ¹åŒ–ï¼š
   - â˜‘ï¸ `Require status checks to pass before merging`
   - â˜‘ï¸ `Require branches to be up to date before merging`
   - Required status checks: `Build`, `Tests`, `Lint`, `Security Scan`, `E2E Tests`

ã“ã‚Œã«ã‚ˆã‚Šã€ã™ã¹ã¦ã®CI/CDãƒã‚§ãƒƒã‚¯ãŒæˆåŠŸã™ã‚‹ã¾ã§ãƒãƒ¼ã‚¸ãƒœã‚¿ãƒ³ãŒç„¡åŠ¹åŒ–ã•ã‚Œã¾ã™ã€‚

##### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

```bash
# CIã‚¨ãƒ©ãƒ¼ã®ç¢ºèª
make pr-check

# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¹ã‚­ãƒ£ãƒ³ã®ãƒ­ãƒ¼ã‚«ãƒ«å®Ÿè¡Œ
make security

# å…¨ãƒ†ã‚¹ãƒˆã®å®Ÿè¡Œ
make test

# ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆä¿®æ­£
make fmt
```
